---
title: "ALGORITMO DE RANDOM FOREST PARA CLASSIFICAÇÃO DE POBREZA NO ESTADO DO CEARÁ"
author: "Francisco Alexandre"
date: "Dezembro 2022"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

<div style="text-align: justify">

### Resumo

Neste trabalho utiliza-se dados da pnad continua do ano de 2019 na primeira pesquisa feita. Tem como objetivo fazer uma classificação de pobreza dos domicilios do ceará, diante disso, o método de random forest foi usado, pois é um algoritmo de aprendizado de máquina utilizado para realizar predições, o algoritmo cria de forma aleatória várias Árvores de Decisão (Decision Trees) e combina o resultado de todas elas para chegar no resultado final. Este método faz parte de um conjunto de métodos de prendizado de maquina chamados de Ensembles, que combinam métodos para gerar um resultado único, trazendo com isso maior robustez aos resultados. Dessa forma, neste trabalho foi encontrado que a maioria dos domicilios cearenses se encontram abaixo da linha de pobreza, representada aqui por 5,5 doláres de rendimento por dia, de acordo com o Banco mundial.

### **1. Introdução**

Os governos atualmente têm enfrentado desafios econômicos, sociais e ambientais cada vez mais complexos. Esses desafios são, ainda mais, agravados pelo aumento da demanda dos cidadãos por bens e serviços públicos por expectativas mais altas pela população, percepção maior percepção de corrupção, e uma erosão da confiança nas instituições públicas (Kusek e Rist, 2013). Nesse contexto, os governos devem ser capazes de demonstrar que suas decisões e políticas são baseadas em evidências, com expectativas realistas acerca do melhor uso dos recursos públicos. Portanto, a avaliação de políticas tem um papel fundamental para garantir os objetivos citados, bem como para evitar falhas políticas através de evidências melhorando as informações obtidas e os métodos usados nas avaliações (Howlett, 2019).

Nos últimos anos, diferentes tipos de políticas de combate à pobreza foram adotadas em países em desenvolvimento. Programas como o *Food for Education* em Bangladesh; *PROGRESA* no México e Bolsa Escola no Brasil, programas focados em transferência de renda condicionados a certos comportamentos por parte dos beneficiários como frequência escolar e acompanhamento de saúde. Esses programas utilizam do mecanismo de *means tests* para seleção, definidos em termos de um nível máximo de rendimento familiar, acima do qual os agregados familiares não são elegíveis para receber o benefício (Bourguignon et al, 2003).

Pretende-se aqui usar um método de inteligencia artificial para classificar pobreza com intuito de auxiliar gestores de politicas públicas para o desenvolvimento de estratégias de focalização voltadas a pobreza. Este trabalho está dividido em três seções. Além desta introdução, temos a etapa de processamento de dados, para mostrar como foi a elaboração técnica e de pesquisa para a obtenção do *dataset* para a realização da modelagem através dos dados da pnad. Após isso, os resultados do modelo, e por último as conclusões.

### **2. Pre-Processamento dos Dados**

A partir do pacote PNADcIBGE, faz-se a leitura dos dados da pnad de 2019 e os respectivos rótulos descritos no dicionário da PNAD.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

### 2.1 Instalação de Pacotes e bibliotecas

```{r pacotes}
# install.packages("PNADcIBGE")
# install.packages("dplyr")
#install.packages("formatR")
```

```{r library,message=FALSE, warning=FALSE}
library(caret)
library(PNADcIBGE)
library(dplyr)
library(randomForest)
```

Foram utilizados o pacote **PNADcIBGE** fornecido pela propia instituição para a obtenção e análise dos dados, o pacote **dplyr** utilizado aqui para o tratamento dos dados, como veremos abaixo, o **caret** para a obtenção da matriz de confusão e *Cross validation* e **randomForest** para a modelagem.

### **2.2 Leitura e tratamento dos Dados**

Podemos ver abaixo a captura dos dados através das funções **read_pnadc** e os rótulos diretamente do dicionário da pnad através da função **pnadc_labeller.**

```{r,results='hide'}
#configuração das margens no pdf
library(formatR)
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)

```

```{r leitura}
#LENDO DADOS DA PNAD CONTÍNUA 2019

caminho = "C:\\Users\\Alexandre Correia\\Desktop\\DADOS\\PNADC_2019_visita1.txt"
input = "C:\\Users\\Alexandre Correia\\Desktop\\DADOS\\input_PNADC_2019_v1.txt"
dadosPNADc <- read_pnadc(microdata=caminho, input_txt=input,vars=c("VD5008","VD5011","V2007","V2009","VD2002","V2005","V2010","VD3004","V4001","V5004A","V1022","V2001","VD2006","S01005","S01010","S01011A","S01012A","S01002","S01001","S01017","S01025","S01023","S01024","S01028","S01021","S01029","S010311","S010312"))

dic = "C:\\Users\\Alexandre Correia\\Desktop\\DADOS\\dic_PNADC_mdados_2019_v1.xls" 
                         
dadosPNADc <- pnadc_labeller(data_pnadc=dadosPNADc,dictionary.file=dic)
```

Neste quadro abaixo é feito um filtro utilizando o pacote **dplyr** com as funções **filter** e **select** de forma a obter os dados apenas de domicilios cearenses e as variavés escolhidas com base no trabalho de Vitor Hugo Miro Couto Silva e João Mário Santos de França de 2021 entitulado: MODELOS DE MACHINE LEARNING NA CLASSIFICAÇÃO DE POBREZA: UMA APLICAÇÃO PARA O ESTADO DO CEARÁ. E dessa forma, com a seleção e filtro passa-se de uma amostra de 443.790 observações e 243 variáveis para 7515 e 25 variáveis selecionadas.

```{r filtro}
#FILTRANDO PARA CEARÁ E VARIAVEIS ESCOLHIDAS

dadosPNADc_ceara <- dadosPNADc %>% filter(UF == "Ceará", V2005 == "Pessoa responsável pelo domicílio")

dadosPNADc_ceara <- select(dadosPNADc_ceara,"VD5008","V2007","V2009","V2005","V2010","VD3004","V4001","V5004A","V1022","V2001","S01005","S01010","S01011A","S01012A","S01002","S01001","S01017","S01025","S01023","S01024","S01028","S01021","S01029","S010311","S010312")
```

Para facilitar a visualização do dataset criado, são renomeadas todas as variáveis com seus respectivos códigos da PNAD contínua.

```{r renomear}
#RENOMEANDO VARIAVEIS

dadosPNADc_ceara2 <- rename(dadosPNADc_ceara, RD_percapta = VD5008, Sex_morador = V2007, idade_morador = V2009, Presenca_morador = V2005 , raca_cor = V2010, N_estM5 = VD3004, trabalhoativo = V4001, aposent = V5004A, area = V1022, npessoas = V2001, qcomodos = S01005, ab_aguaadeq = S01010, banhexclusi = S01011A, esgS_adeq = S01012A, pare_adeq = S01002, tipo_res = S01001,  prop_domi = S01017, tv = S01025, refrig = S01023, maq_lav = S01024, comp = S01028, q_mcelular = S01021, internet = S01029, autom = S010311, moto = S010312 )
```

Além, disso. Para efeito de tratamento deve-se transformar todas as variáveis categóricas, muitas delas no formato de caracteres obtidos da própria pesquisa, em váriavéis númericas ou binárias para que de fato esteja no formato de linguagem em que o computador é capaz de processar dados e também para um melhor entendimento dos resultados.

+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | **Variáveis Dependentes**                                                                                                                                                        |      | **Descrição**                                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Sexo do morador                                                                                                                                                                  |      | **Binária:**                                                                                                                                                                                                                    |      |
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
|      |                                                                                                                                                                                  |      | (1)Mulher; (0) Homem                                                                                                                                                                                                            |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Idade do chefe de domicílio                                                                                                                                                      |      | Numérica                                                                                                                                                                                                                        |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Morador entrevistado                                                                                                                                                             |      | Pessoa responsável pelo domicílio                                                                                                                                                                                               |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Cor declarada pelo chefe de domicílio                                                                                                                                            |      | (1)Branca ou Amarela; (0) Preto, pardo, indigena                                                                                                                                                                                |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Nível de instrução mais elevado alcançado (pessoas de 5 anos ou mais de idade) padronizado para o Ensino fundamental com duração de 9 anos                                       |      | Conjunto de dummies para os seguintes níveis de escolaridade: (1) sem instrução, (2) fundamental incompleto, (3) fundamental completo, (4) médio incompleto, (5) médio completo, (6 )superior incompleto; (7) superior completo |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Na semana de referência trabalhou ou estagiou, durante pelo menos 1 hora, em alguma atividade remunerada em dinheiro                                                             |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | No mês de referência recebeu rendimentos de aposentadoria ou pensão de instituto de previdência federal (INSS), estadual, municipal, ou do governo federal, estadual, municipal? |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Situação do domicílio                                                                                                                                                            |      | **Binária:** (1) Rural; (0) Urbana                                                                                                                                                                                              |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Número de pessoas no domicílio                                                                                                                                                   |      | Numérica                                                                                                                                                                                                                        |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Quantos cômodos tem este domicílio                                                                                                                                               |      | Numérica                                                                                                                                                                                                                        |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Como chega a água utilizada neste domicílio.                                                                                                                                     |      | **Binária:** (1) Canalizada em pelo menos um comodo ou Canalizada só na propriedade ou terreno; (0) Não canalizada                                                                                                              |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Banheiro exclusivo do domicílio.                                                                                                                                                 |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Esgotamento sanitário adequado.                                                                                                                                                  |      | **Binária:** (1) Rede geral, rede pluvial ouFossa séptica ligada à rede; (0) Não                                                                                                                                                |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Material que predomina na construção das paredes externas deste domicílio                                                                                                        |      | **Binária:** (1) Alvenaria com revestimento/ taipa com revestimento; (0) Não                                                                                                                                                    |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Este domicílio é do tipo:                                                                                                                                                        |      | **Binária:** (1) Apartamento; (0) Casa                                                                                                                                                                                          |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | domicilio próprio e quitado                                                                                                                                                      |      | **Binária:** (1) Próprio de algum morador - já pago (0) Não                                                                                                                                                                     |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Este domicílio tem televisão?                                                                                                                                                    |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Este domicílio tem geladeira?                                                                                                                                                    |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Este domicílio tem máquina de lavar roupa?                                                                                                                                       |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Este domicílio tem microcomputador (considere inclusive os portáteis, tais como: laptop, notebook, ultrabook ou netbook)?                                                        |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Posse de telefone                                                                                                                                                                |      | nº de aparelhos/ residentes                                                                                                                                                                                                     |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Algum morador tem acesso à Internet no domicílio por meio de microcomputador, tablet, telefone móvel celular, televisão ou outro equipamento?                                    |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Algum morador deste domicilio tem automóvel para uso pessoal?                                                                                                                    |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      | Algum morador deste domicilio tem motocicleta para uso pessoal?                                                                                                                  |      | **Binária:** (1) Sim; (0) Não                                                                                                                                                                                                   |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+
|      |                                                                                                                                                                                  |      |                                                                                                                                                                                                                                 |      |
+------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+

Ademais, cria-se a variável dependente binária já que estamos tratando de um modelo de classificação.

$$
y_i(r_i,W) = \begin{cases} 1, & r_i<W \\ 0, & r_i \geq W \end{cases}
$$

Onde $r_i$ é a renda domiciliar percapta e $W$ valor em reais da linha de pobreza mensal.

```{r categoricas para númericas e binárias, }

#CRIANDO VARIÁVEL DEPENDENTE E TRANSFORMANDO EM BINÁRIA DE ACORDO COM LINHA DE POBREZA DE 5,5 DOLARES POR DIA. CONVERTIDA PARA REAIS E MULTIPLICADA POR 30 PARA 1 MÊS.
 
linha_pobreza_mes = (5.21*5.5)*30
dadosPNADc_ceara2 = mutate(dadosPNADc_ceara2, RD_percapta = ifelse(RD_percapta < linha_pobreza_mes, 1,0))

#atributos modificados para o modelo
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, Sex_morador = ifelse(Sex_morador == "Mulher", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, raca_cor = ifelse(raca_cor == "Branca" | raca_cor =="Amarela", 1, 0))
dadosPNADc_ceara2$N_estM5 <- as.numeric(dadosPNADc_ceara2$N_estM5)
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, trabalhoativo = ifelse(trabalhoativo == "Sim", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, aposent = ifelse(aposent == "Sim", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, area = ifelse(area == "Rural", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, ab_aguaadeq = ifelse(ab_aguaadeq == "Não canalizada", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, banhexclusi = ifelse(banhexclusi == "0", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, esgS_adeq = ifelse(esgS_adeq == "Rede geral, rede pluvial" | esgS_adeq == "Fossa séptica ligada à rede", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, pare_adeq = ifelse(pare_adeq == "Alvenaria com revestimento/ taipa com revestimento", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, tipo_res = ifelse(tipo_res == "Apartamento", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, prop_domi = ifelse(prop_domi == "Próprio de algum morador - já pago", 1, 0))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, tv = ifelse(tv == "Não", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, refrig = ifelse(refrig == "Não", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, maq_lav = ifelse(maq_lav == "Não", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, comp = ifelse(comp == "Não", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, q_mcelular = q_mcelular / npessoas)
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, internet = ifelse(internet == "Não", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, autom = ifelse(autom == "Não", 0, 1))
dadosPNADc_ceara2 <- mutate(dadosPNADc_ceara2, moto = ifelse(moto == "Não", 0, 1))

```

Na amostra, a coluna sistema de esgoto adequado possuia alguns itens faltantes , e por isso, optou-se por retirar as linhas que possuiam essa falta de informação, com isso a amostra passou de um tamanho de 7515 para 7325, uma diminuição de aproximadamente 2,5%.

```{r excluindo itens faltantes da base}
any(is.na(dadosPNADc_ceara2))
dadosPNADc_ceara2 = na.omit(dadosPNADc_ceara2)
any(is.na(dadosPNADc_ceara2))
```

### 3. Resultados

Com os dados tratados e o datasert definido, agora pode-se construir o modelo de floresta aleatória. Em primeiro lugar, deve-se dividir os dados em duas amostra, uma para o ajustamento do modelo, chamada de treino e outra para a testagem do modelo em uma nova amostra a fim de obtermos uma generalização do método. Os dados são divididos em 75% para treino e 25% para teste.

```{r modelo}
#trasformando RD_percapta em factor para realização do método random forest

dadosPNADc_ceara2$RD_percapta <- as.factor(dadosPNADc_ceara2$RD_percapta)

#separando dados de treino e teste de maneira randomica

maxlinhas = length(dadosPNADc_ceara2$RD_percapta)
linhas75p = length(dadosPNADc_ceara2$RD_percapta)*.75

set.seed(100)

linhas = sample(1:maxlinhas,linhas75p)

#dados de treino 75%
treino = dadosPNADc_ceara2[linhas,]

#dados de teste 25%
teste = dadosPNADc_ceara2[-linhas,]

#Algoritmo de Random forest

#fit do modelo

modelo = randomForest(RD_percapta~., data = treino, maxnodes=8, ntree=100)

#prevendo modelo
pred_modelo <- predict(modelo,teste, type = 'response')

```

Nos gráficos a seguir, podemos ver os resultados encontrados a partir do método de random forest. Nota-se que há um melhor ajustamento do modelo ao aumentar o número de nós e árvores. ao fazer vários testes se observou que com 8 nós e 100 árvores tem-se uma maior acurácia do modelo.

```{r grafico1, fig.align='center'}
plot(modelo, main = "Ajustamento do Random Forest")
```

```{r grafico2, fig.align='center'}

varImpPlot(modelo, sort=TRUE, main = "Importancia das features", n.var = 20 )

```

Neste gráfico, observamos a importancia dos atributos medidos pela redução média do indice de gini, ou seja uma uma diminuição da impureza entre os parent nodes and daughter nodes.

```{r grafico3, fig.align='center'}

plot(pred_modelo)
title(main = "Status de Pobreza")
title(xlab = "(0) Acima da linha de pobreza    (1) Abaixo da linha de pobreza", ylab = "numero de observacoes no teste")


```

Aqui obervamos as previsões do modelo que indica uma maior taxa de pessoas abaixo da linha de pobreza. um total de 439 observações acima da linha de pobreza com "0" e 1393 observações abaixo da linha de pobreza com "1". Um total de 76% abaixo da linha de pobreza.

### 3.2 Matriz de confusão

```{r matriz de confusão, fig.align='center'}
#matriz de confusão
confusionMatrix(teste$RD_percapta, pred_modelo)

```

Com base nas informações da matriz de confusão podemos obter medidas de desempenho preditivo do modelo. Temos que o modelo previu 1393 domicílios abaixo da linha de pobreza, dos quais 1152 são predições corretas e 241 são falsos positivos. Isso corresponde a uma precisão de 82,7%. diante disso, considerado os 1393 domicílios considerados pobres no conjunto de teste, a medida de sensibilidade (recall) que é calculado como o número de previsões positivas corretas dividido pelo número total de positivos, mostra que 87% dos domicílios pobres foram previstos corretamente. Por fim, a medida de acurácia total aponta para uma precisão geral do modelo em cerca de 83%.

### 3.1  Validação Cruzada

A validação cruzada é usada principalmente em aprendizado de maquina para estimar a habilidade de um modelo em dados não vistos. Ou seja, usar uma amostra limitada para estimar o desempenho.

```{r Validação cruzada}

#validação cruzada usando caret

fitControl <- trainControl(method = "cv",
                           number = 5)

ajuste_modelo <- train(RD_percapta ~ ., 
                     data = treino,
                     method = "rf", 
                     importance = TRUE,
                     trControl = fitControl)

```

```{r}ajuste_modelo}

```

Podemos observar que obtemos uma maior acurácia no mtry = 21, bem aproximado a forma anterior de validação. Número de variáveis ​​amostradas aleatoriamente como candidatas em cada divisão.

### 3.2 Árvore de decisão

Podemos ver abaixo um exemplo de arvore de decisão com a utilização dos dados.

```{r arvore, fig.align='center'}
# Representação de uma Árvore de decisão na amostra treino
library(rpart)
library(rpart.plot)
x <- rpart(RD_percapta ~ ., method = "class", data = treino)
prp(x, extra = 6)


```

No entanto, uma Random Forest (ou Floresta Aleatória) é a combinação de centenas de árvores de classificação. Este resultado segue do fato de que a combinação de diversos modelos diferentes é melhor do que um modelo sozinho. Mas podemos ver uma relação entre as probabilidades dessas variaveis e os resultados da importancia das variaveis no metodo de Random Forest.

### 4. Conclusão

Neste trabalho, observamos que a maior parte dos domiclios estudados do Ceará se encontram abaixo da linha de pobreza, este fato pode se traduzir em estratégias para a redução da pobreza no estado, observamos que algumas variáveis são mais importantes quando se trata da redução dos níveis de pobreza no estado como por exemplo, a idade do chefe de familia, o numero de residentes no domicilio e o nível de esducação do responsável.

Além disso, outras aplicações usando modelos de inteligencia artificial podem ser feitas de modo a aprimorar as políticas do estado e também aprimorar esse trabalho para outras regiões do país, bem como a nível nacional. Outras estratégias de seleção de variavéis podem ser abordadas e outras estratégias podem ser tomadas de forma a melhorar a acurácia do modelo.

</div>

### 5. Referências

MIRO, V. H. ; FRANCA, J. M. S. . Modelos de machine learning na classificação de pobreza: uma aplicação para o estado do Ceará. In: 49 Encontro Nacional de Economia - ANPEC, 2021, Brasília. 49 Encontro Nacional de Economia, 2021.

Kuhn M (2022). \_caret: Classification and Regression Training\_. R package version 6.0-93, <https://CRAN.R-project.org/package=caret>.

Braga D, Assuncao G (2022). \_PNADcIBGE: Downloading, Reading and Analyzing PNADC Microdata\_. R package version 0.7.1, <https://CRAN.R-project.org/package=PNADcIBGE>.

Wickham H, François R, Henry L, Müller K (2022). \_dplyr: A Grammar of Data Manipulation\_. R package version 1.0.10, <https://CRAN.R-project.org/package=dplyr>.

A. Liaw and M. Wiener (2002). Classification and Regression by randomForest. R News 2(3), 18--22.

Therneau T, Atkinson B (2022). \_rpart: Recursive Partitioning and Regression Trees\_. R package version 4.1.19, <https://CRAN.R-project.org/package=rpart>.

KUZEK JODY, RIST RAY. Ten Steps to a Results-Based Monitoring and Evaluation System:A Handbook for Development Practitioners. [S. l.]: World Bank Group, 2004. Disponível em: [ttps://elibrary.worldbank.org/doi/abs/10.1596/0-8213-5823-5.](https://elibrary.worldbank.org/doi/abs/10.1596/0-8213-5823-5.) Acesso em: 7 Dez. 2022.

Howlett, M.
(2019), \"Policy analytical capacity and evidence‐based policy‐making: Lessons from Canada\", <https://doi.org/10.1111/j.1754-7121.2009.00070_1.x>.

Bourguignon, F., Chakravarty, S.R. The Measurement of Multidimensional Poverty. *The Journal of Economic Inequality* **1**, 25--49 (2003). <https://doi.org/10.1023/A:1023913831342>
